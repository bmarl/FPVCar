<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Roboter test application</title>
<link href="{{ url_for('static', filename='js/jquery-ui-1.12.1.custom/jquery-ui.css') }}" rel="stylesheet">
<link href="{{ url_for('static', filename='js/jquery-ui-iconfont-master/jquery-ui.icon-font.css') }}" rel="stylesheet" type="text/css">
<link href="{{ url_for('static', filename='css/robota.css') }}" rel="stylesheet">

<script src="{{ url_for('static', filename='js/jquery-ui-1.12.1.custom/external/jquery/jquery.js') }}"></script>
<script src="{{ url_for('static', filename='js/jquery-ui-1.12.1.custom/jquery-ui.js') }}"></script>

<link rel="shortcut icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
</head>
<body>

	<div id="labelCurrentSetCamera">
		<label>Control:Camera position:</label>
		<input type="text" id="labelPositionPitch" readonly />
		<input type="text" id="positionPitch" readonly	/>
	</div>

	<div id="slider-position-pitch"></div>
	<div id="slider-position-yaw"></div>

	<div id='labelResult'>
		<label>Result:</label>
		<input type='text' id='moveResult' readonly />
	</div>
	<!-- base directions ---------------------------------------------------------------->
	<div id="tableBaseDirections">
		<table>
			<tr>
				<td colspan="3">Control:Base Move</td>
			</tr>
			<tr>
				<td><a id="turnLeft" class="ui-icon ui-icon-arrowreturnthick-1-w"><span>turnleft</span></a></td>
				<td><a id="moveForward" class="ui-icon ui-icon-arrowthick-1-n"><span>forward</span></a></td>
				<td><a id="turnRight" class="ui-icon ui-icon-arrowreturnthick-1-e"><span>turnright</span></a></td>
			</tr>
			<tr>
				<td><a id="moveLeft" class="ui-icon ui-icon-arrowthick-1-w"><span>moveleft</span></a></td>
				<td>
					<div id="steercontainter">
						<canvas id="cnvsJoy" width="100px" height="100px"></canvas>
					</div>
				</td>
				<td><a id="moveRight" class="ui-icon ui-icon-arrowthick-1-e"><span>moveright</span></a></td>
			</tr>
			<tr>
                <td><a id="stand" class="ui-icon ui-icon-closethick"><span>stand</span></a></td>
				<td><a id="moveBackward" class="ui-icon ui-icon-arrowthick-1-s"><span>moveback</span></a></td>
				<td></td>
			</tr>
			<tr>
				<td colspan="3">
					<div id="lblBaseVel">
						<label>Base velocity:</label>
						<input type="text" id="lblVel" readonly />
					</div>
				</td>
			</tr>
		</table>
	</div>

	<!-- Shutdown Button -------------------------------------------------------->
	<div id="iconShutdown">
		<a href="/robota/api/doShutdown" class="ui-icon ui-icon-power">icon</a>
	</div>

  <!-- Scripts ----------------------------------------------------------------->
	<script>
		//TODO in zentrale Konfig auslagern und auch in app laden
		var appNameShort = 'robota';
		var base = { move: 'stop' };
		var left = { posYaw : 37, posPitch : 37 };
		var textYaw = 'yaw';
		var textPitch = 'pitch';
		var url = '/' + appNameShort + '/api';

		//--init-------------------------------------------------
		$(function() {
			/*set default screen text values*/
			$("#moveResult").val(" [ not yet ]");
			$("#labelPositionPitch").val(textYaw + " " + left.posYaw);
			$("#positionPitch").val(textPitch + " " + left.posPitch);
			/*set arrow functions*/
			document.getElementById("moveLeft").addEventListener("click", function () {
				base.move = 'left';
				doMove(base)
			});
			document.getElementById("moveForward").addEventListener("click", function () {
				base.move = 'forward';
				doMove(base)
			});
			document.getElementById("moveRight").addEventListener("click", function () {
				base.move = 'right';
				doMove(base)
			});
			document.getElementById("moveBackward").addEventListener("click", function () {
				base.move = 'backward';
				doMove(base)
			});
			document.getElementById("turnLeft").addEventListener("click", function () {
				base.move = 'turnLeft';
				doMove(base)
			});
			document.getElementById("turnRight").addEventListener("click", function () {
				base.move = 'turnRight';
				doMove(base)
			});
			document.getElementById("stand").addEventListener("click", function () {
				base.move = 'stand';
				doMove(base)
			});
		});
		/*yaw slider*/
		$(function() {
			$("#slider-position-yaw").slider({
				range : "min",
				value : left.posYaw,
				min : 1,
				max : 255,
				slide : function(event, ui) {
					left.posYaw = ui.value;
					$("#labelPositionPitch").val(textYaw + " " + left.posYaw);
					move_eye(left)
				}
			});
		});

		/*pitch slider*/
		$(function() {
			$("#slider-position-pitch").slider({
				orientation : "vertical",
				range : "min",
				value : left.posPitch,
				min : 1,
				max : 255,
				slide : function(event, ui) {
					left.posPitch = ui.value;
					$("#positionPitch").val(textPitch + " " + left.posPitch);
					move_eye(left);
				}
			});
		});

		function move_eye(left){
			data = JSON.stringify(left);
			$.ajax({
			  url:url + '/eye/left',
			  type:"POST",
			  data:data,
			  contentType:"application/json; charset=utf-8",
			  dataType:"json",
			  success: function(leftEyePosition){
			  	newPosition = 'CameraPostion: YAW:' + leftEyePosition.posYaw + ' Pitch:'+ leftEyePosition.posPitch;
				showMoveResult(newPosition);
			  }
			})
		};

		function move_base(base){
			data = JSON.stringify(base);
			$.ajax({
			  url:url + '/base',
			  type:"POST",
			  data:data,
			  contentType:"application/json; charset=utf-8",
			  dataType:"json",
			  success: function(baseMove){
			  	console.log(baseMove);
			  	newMove = 'BaseMove: linearX:' + baseMove.linearX + ' linearY:'+ baseMove.linearY;
				showMoveResult(newMove);
			  }
			})
		};

		function showMyPositions(myPositions) {
			var positions = "";
			for ( var p in myPositions) {
				positions = positions + p + ":" + (myPositions[p] + " ");
			}
			showMoveResult(positions);
		};

		function doMove(m){
			$.post(url + '/move', m).done( function(result) {
			showMoveResult(result);	});
		};

		function showMoveResult(result){
			$("#moveResult").val(result);
		};

	</script>
    <script src="{{ url_for('static', filename='js/canvasJoystick.js') }}"></script>
</body>
</html>
